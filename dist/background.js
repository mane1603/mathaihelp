(()=>{"use strict";var e,t={994:(e,t,n)=>{var o=n(83),r=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function i(e){try{u(o.next(e))}catch(e){c(e)}}function a(e){try{u(o.throw(e))}catch(e){c(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((o=o.apply(e,t||[])).next())}))},c=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,o=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){c.label=a[1];break}if(6===a[0]&&c.label<r[1]){c.label=r[1],r=a;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(a);break}r[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};function i(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(function n(o){o[0].id&&chrome.tabs.sendMessage(o[0].id,{type:t,response:e},(function(r){if(!chrome.runtime.lastError)return console.log("Message sent successfully from background: ",t,e);setTimeout((function(){return n(o)}),400)}))}))}chrome.runtime.onInstalled.addListener((function(){console.log("Screenshot Extension Installed")})),chrome.runtime.onMessage.addListener((function(e,t,n){if("startAuth"===e.type)return console.log("Background script started Auth"),chrome.identity.launchWebAuthFlow({url:"http://localhost:5555/auth/google",interactive:!0},(function(e){if(console.log("Redirect URL:",e),chrome.runtime.lastError||!e)return console.error("Ошибка при аутентификации:",chrome.runtime.lastError),void n({success:!1,error:chrome.runtime.lastError});var t=function(e){var t=new URLSearchParams(new URL(e).search);return console.log("background.ts:134:4 code:",t.get("code")),t.get("code")}(e);fetch("http://localhost:5555/auth/google/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})}).then((function(e){return e.json()})).then((function(e){e.token?chrome.storage.local.set({token:e.token},(function(){console.log("Token saved to Chrome storage:",e.token),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var n;(null===(n=t[0])||void 0===n?void 0:n.id)&&chrome.tabs.sendMessage(t[0].id,{type:"authSuccess",token:e.token},(function(){console.log("Token sent to content script")}))}))})):console.error("Failed to retrieve token from server.")})).catch((function(e){return console.error("Error exchanging code for token:",e)})),n({success:!0,code:t})})),!0})),chrome.runtime.onMessage.addListener((function(e,t,n){if("captureSelection"===e.type){console.log("Message received in background script:",e.type);var a=e.rect,u=a.x,s=a.y,l=a.width,f=a.height;if(!e.rect)return;chrome.tabs.captureVisibleTab({format:"png"},(function(e){fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e)})).then((function(e){var t=new OffscreenCanvas(l,f),n=t.getContext("2d");null==n||n.drawImage(e,u,s,l,f,0,0,l,f),t.convertToBlob().then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){return r(void 0,void 0,void 0,(function(){var e,n;return c(this,(function(a){return(e=null===(n=t.result)||void 0===n?void 0:n.toString())?(i("Loading...","startDisplay"),function(e){return r(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.A.post("http://localhost:5555/image/upload",{url:e,language:"English"})];case 1:return[2,t.sent()]}}))}))}(e).then((function(e){console.log(e),i(e.data.gptResponse,"responseSuccess")}))):console.log("croppedScreenshotUrl does not exist"),[2]}))}))}}))})).catch((function(e){return console.error("Ошибка при получении изображения:",e)}))}))}return!0}))}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var c=n[e]={exports:{}};return t[e](c,c.exports,o),c.exports}o.m=t,e=[],o.O=(t,n,r,c)=>{if(!n){var i=1/0;for(l=0;l<e.length;l++){n=e[l][0],r=e[l][1],c=e[l][2];for(var a=!0,u=0;u<n.length;u++)(!1&c||i>=c)&&Object.keys(o.O).every((e=>o.O[e](n[u])))?n.splice(u--,1):(a=!1,c<i&&(i=c));if(a){e.splice(l--,1);var s=r();void 0!==s&&(t=s)}}return t}c=c||0;for(var l=e.length;l>0&&e[l-1][2]>c;l--)e[l]=e[l-1];e[l]=[n,r,c]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={471:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,c,i=n[0],a=n[1],u=n[2],s=0;if(i.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(u)var l=u(o)}for(t&&t(n);s<i.length;s++)c=i[s],o.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return o.O(l)},n=self.webpackChunkmath_help_ai_front=self.webpackChunkmath_help_ai_front||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=o.O(void 0,[83],(()=>o(994)));r=o.O(r)})();
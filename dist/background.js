(()=>{"use strict";var e,n={994:(e,n,t)=>{var o=t(83),r=function(e,n,t,o){return new(t||(t=Promise))((function(r,c){function i(e){try{a(o.next(e))}catch(e){c(e)}}function s(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}a((o=o.apply(e,n||[])).next())}))},c=function(e,n){var t,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(c=0)),c;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,o=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){c.label=s[1];break}if(6===s[0]&&c.label<r[1]){c.label=r[1],r=s;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(s);break}r[2]&&c.ops.pop(),c.trys.pop();continue}s=n.call(e,c)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};function i(){return r(this,void 0,void 0,(function(){return c(this,(function(e){return[2,new Promise((function(e){chrome.storage.local.get(["token"],(function(n){(null==n?void 0:n.token)?e(n.token):e(null)}))}))]}))}))}function s(e){return r(this,void 0,void 0,(function(){var n=this;return c(this,(function(t){switch(t.label){case 0:return[4,i().then((function(t){return r(n,void 0,void 0,(function(){var n,r;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,o.A.post("http://localhost:5555/image/upload",{url:e,language:"English"},{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})];case 1:return n=c.sent(),console.log(n.data.gptResponse),[2,n.data.gptResponse];case 2:return r=c.sent(),console.error("Error in request:",r),[2,"No Token"];case 3:return[2]}}))}))})).catch((function(e){return console.log(e),"No Token"}))];case 1:return[2,t.sent()]}}))}))}function a(e,n){var t=!1;chrome.tabs.query({active:!0,currentWindow:!0},(function o(i){return r(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return!i[0].id||t?[3,2]:[4,chrome.tabs.sendMessage(i[0].id,{type:n,response:e},(function(e){chrome.runtime.lastError?setTimeout((function(){return o(i)}),400):e&&e.success?(t=!0,console.log("Message sent successfully from background: ",n)):console.log("No response from content script")}))];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}))}chrome.runtime.onInstalled.addListener((function(){console.log("Service Worker: Installed")})),chrome.runtime.onStartup.addListener((function(){console.log("Service Worker: Started")})),self.addEventListener("activate",(function(){console.log("Service Worker: Activated")})),chrome.runtime.onMessage.addListener((function(e,n,t){return r(void 0,void 0,void 0,(function(){return c(this,(function(n){return"get-user-data"===e&&t("Hello from background"),[2,!0]}))}))})),chrome.runtime.onMessage.addListener((function(e,n,t){return r(void 0,void 0,void 0,(function(){return c(this,(function(n){return"startAuth"===e.type?(console.log("Background script started Auth"),chrome.identity.launchWebAuthFlow({url:"http://localhost:5555/auth/google",interactive:!0},(function(e){if(console.log("Redirect URL:",e),chrome.runtime.lastError||!e)return console.error("Ошибка при аутентификации:",chrome.runtime.lastError),void t({success:!1,error:chrome.runtime.lastError});var n=function(e){var n=new URLSearchParams(new URL(e).search);return console.log("background.ts:134:4 code:",n.get("code")),n.get("code")}(e);console.log(n),fetch("http://localhost:5555/auth/google/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})}).then((function(e){return e.json()})).then((function(e){e.token?chrome.storage.local.set({token:e.token},(function(){console.log("Token saved to Chrome storage:",e.token),chrome.tabs.query({active:!0,currentWindow:!0},(function(n){var t;(null===(t=n[0])||void 0===t?void 0:t.id)&&chrome.tabs.sendMessage(n[0].id,{type:"authSuccess",token:e.token},(function(e){console.log("Token sent to content script")}))}))})):console.error("Failed to retrieve token from server.")})).catch((function(e){return console.error("Error exchanging code for token:",e)})),t({success:!0,code:n})})),[2,!0]):[2]}))}))})),chrome.runtime.onConnect.addListener((function(e){"popup-background"===e.name&&e.onMessage.addListener((function(n){"test"===n.type&&(console.log("Test port from Background, message:",n),e.postMessage({result:"screenshot taken"}))}))})),chrome.runtime.onMessage.addListener((function(e,n,t){return r(void 0,void 0,void 0,(function(){var n,t,o,i,u;return c(this,(function(l){switch(l.label){case 0:return"captureSelection"!==e.type?[3,2]:(console.log("Message received in background script:",e.type),n=e.rect,t=n.x,o=n.y,i=n.width,u=n.height,e.rect?[4,chrome.tabs.captureVisibleTab({format:"png"},(function(e){fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e)})).then((function(e){var n=new OffscreenCanvas(i,u),l=n.getContext("2d");null==l||l.drawImage(e,t,o,i,u,0,0,i,u),n.convertToBlob().then((function(e){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){return r(void 0,void 0,void 0,(function(){var e,t;return c(this,(function(o){switch(o.label){case 0:return(e=null===(t=n.result)||void 0===t?void 0:t.toString())?(a("Loading...","startDisplay"),[4,s(e).then((function(e){console.log("RESULT AAAAAAA",e),e&&"No Token"===e?a("","responseDenied"):e&&(console.log(e),a(e,"responseSuccess"))})).catch((function(e){return console.log(e)}))]):[3,2];case 1:return o.sent(),[3,3];case 2:console.log("croppedScreenshotUrl does not exist"),o.label=3;case 3:return[2]}}))}))}}))})).catch((function(e){return console.error("Ошибка при получении изображения:",e)}))}))]:[2]);case 1:l.sent(),l.label=2;case 2:return[2,!0]}}))}))}))}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var c=t[e]={exports:{}};return n[e](c,c.exports,o),c.exports}o.m=n,e=[],o.O=(n,t,r,c)=>{if(!t){var i=1/0;for(l=0;l<e.length;l++){t=e[l][0],r=e[l][1],c=e[l][2];for(var s=!0,a=0;a<t.length;a++)(!1&c||i>=c)&&Object.keys(o.O).every((e=>o.O[e](t[a])))?t.splice(a--,1):(s=!1,c<i&&(i=c));if(s){e.splice(l--,1);var u=r();void 0!==u&&(n=u)}}return n}c=c||0;for(var l=e.length;l>0&&e[l-1][2]>c;l--)e[l]=e[l-1];e[l]=[t,r,c]},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={471:0};o.O.j=n=>0===e[n];var n=(n,t)=>{var r,c,i=t[0],s=t[1],a=t[2],u=0;if(i.some((n=>0!==e[n]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(a)var l=a(o)}for(n&&n(t);u<i.length;u++)c=i[u],o.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return o.O(l)},t=self.webpackChunkmath_help_ai_front=self.webpackChunkmath_help_ai_front||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var r=o.O(void 0,[83],(()=>o(994)));r=o.O(r)})();
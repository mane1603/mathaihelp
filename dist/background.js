(()=>{"use strict";var e,t={994:(e,t,n)=>{var o=n(83),r=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function s(e){try{a(o.next(e))}catch(e){c(e)}}function i(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((o=o.apply(e,t||[])).next())}))},c=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function s(){return r(this,void 0,void 0,(function(){return c(this,(function(e){return[2,new Promise((function(e){chrome.storage.local.get(["token"],(function(t){(null==t?void 0:t.token)?e(t.token):e(null)}))}))]}))}))}function i(e){return r(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){switch(n.label){case 0:return[4,s().then((function(n){return r(t,void 0,void 0,(function(){var t,r;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,o.A.post("http://localhost:5555/image/upload",{url:e,language:"English"},{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}})];case 1:return t=c.sent(),console.log(t.data.gptResponse),[2,t.data.gptResponse];case 2:return r=c.sent(),console.error("Error in request:",r),[2,"No Token"];case 3:return[2]}}))}))})).catch((function(e){return console.log(e),"No Token"}))];case 1:return[2,n.sent()]}}))}))}function a(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(function n(o){o[0].id&&chrome.tabs.sendMessage(o[0].id,{type:t,response:e},(function(e){chrome.runtime.lastError?setTimeout((function(){return n(o)}),400):e&&e.success?console.log("Message sent successfully from background: ",t):console.log("No response from content script")}))}))}chrome.runtime.onInstalled.addListener((function(){console.log("Screenshot Extension Installed")})),chrome.runtime.onMessage.addListener((function(e,t,n){if("startAuth"===e.type)return console.log("Background script started Auth"),chrome.identity.launchWebAuthFlow({url:"http://localhost:5555/auth/google",interactive:!0},(function(e){if(console.log("Redirect URL:",e),chrome.runtime.lastError||!e)return console.error("Ошибка при аутентификации:",chrome.runtime.lastError),void n({success:!1,error:chrome.runtime.lastError});var t=function(e){var t=new URLSearchParams(new URL(e).search);return console.log("background.ts:134:4 code:",t.get("code")),t.get("code")}(e);fetch("http://localhost:5555/auth/google/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})}).then((function(e){return e.json()})).then((function(e){e.token?chrome.storage.local.set({token:e.token},(function(){console.log("Token saved to Chrome storage:",e.token),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var n;(null===(n=t[0])||void 0===n?void 0:n.id)&&chrome.tabs.sendMessage(t[0].id,{type:"authSuccess",token:e.token},(function(e){console.log("Token sent to content script")}))}))})):console.error("Failed to retrieve token from server.")})).catch((function(e){return console.error("Error exchanging code for token:",e)})),n({success:!0,code:t})})),!0})),chrome.runtime.onMessage.addListener((function(e,t,n){if("startSelection"===e.type&&(console.log("Message recieved in Background"),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"startSelection"})})),n({success:!0})),"captureSelection"===e.type){console.log("Message received in background script:",e.type);var o=e.rect,s=o.x,u=o.y,l=o.width,f=o.height;if(!e.rect)return;n({success:!0}),chrome.tabs.captureVisibleTab({format:"png"},(function(e){fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e)})).then((function(e){var t=new OffscreenCanvas(l,f),n=t.getContext("2d");null==n||n.drawImage(e,s,u,l,f,0,0,l,f),t.convertToBlob().then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){return r(void 0,void 0,void 0,(function(){var e,n;return c(this,(function(o){switch(o.label){case 0:return(e=null===(n=t.result)||void 0===n?void 0:n.toString())?(a("Loading...","startDisplay"),[4,i(e).then((function(e){console.log("RESULT AAAAAAA",e),e&&"No Token"===e?a("","responseDenied"):e&&(console.log(e),a(e,"responseSuccess"))})).catch((function(e){return console.log(e)}))]):[3,2];case 1:return o.sent(),[3,3];case 2:console.log("croppedScreenshotUrl does not exist"),o.label=3;case 3:return[2]}}))}))}}))})).catch((function(e){return console.error("Ошибка при получении изображения:",e)}))}))}return!0}))}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var c=n[e]={exports:{}};return t[e](c,c.exports,o),c.exports}o.m=t,e=[],o.O=(t,n,r,c)=>{if(!n){var s=1/0;for(l=0;l<e.length;l++){n=e[l][0],r=e[l][1],c=e[l][2];for(var i=!0,a=0;a<n.length;a++)(!1&c||s>=c)&&Object.keys(o.O).every((e=>o.O[e](n[a])))?n.splice(a--,1):(i=!1,c<s&&(s=c));if(i){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}c=c||0;for(var l=e.length;l>0&&e[l-1][2]>c;l--)e[l]=e[l-1];e[l]=[n,r,c]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={471:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,c,s=n[0],i=n[1],a=n[2],u=0;if(s.some((t=>0!==e[t]))){for(r in i)o.o(i,r)&&(o.m[r]=i[r]);if(a)var l=a(o)}for(t&&t(n);u<s.length;u++)c=s[u],o.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return o.O(l)},n=self.webpackChunkmath_help_ai_front=self.webpackChunkmath_help_ai_front||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=o.O(void 0,[83],(()=>o(994)));r=o.O(r)})();